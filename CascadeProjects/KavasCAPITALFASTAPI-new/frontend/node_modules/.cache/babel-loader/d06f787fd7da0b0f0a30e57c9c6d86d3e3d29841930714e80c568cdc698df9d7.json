{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\inder\\\\CascadeProjects\\\\KavasCAPITALFASTAPI-new\\\\frontend\\\\src\\\\components\\\\Auth\\\\AccessTokenInput.tsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useCallback, useEffect } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { Box, TextField, Button, CircularProgress, Snackbar, Alert } from '@mui/material';\nimport { setAccessToken, setAuthenticated } from '../../store/slices/authSlice';\nimport { useWebSocket } from '../../hooks/useWebSocket';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const AccessTokenInput = () => {\n  _s();\n  const dispatch = useDispatch();\n  const {\n    isAuthenticated\n  } = useSelector(state => state.auth);\n  const [token, setToken] = useState('');\n  const [loading, setLoading] = useState(false);\n  const [successMessage, setSuccessMessage] = useState('');\n  const [error, setError] = useState(null);\n  const {\n    connect\n  } = useWebSocket();\n\n  // Check for existing token on mount\n  useEffect(() => {\n    const savedToken = localStorage.getItem('kite_access_token');\n    if (savedToken) {\n      validateAndSetToken(savedToken);\n    }\n  }, []);\n  const validateAndSetToken = async tokenToValidate => {\n    setLoading(true);\n    try {\n      // First validate the token\n      const validateResponse = await fetch('http://localhost:8000/api/v1/kite/validate', {\n        headers: {\n          'Authorization': `Bearer ${tokenToValidate}`\n        }\n      });\n      if (!validateResponse.ok) {\n        throw new Error('Invalid token');\n      }\n\n      // If validation successful, set the token\n      const response = await fetch('http://localhost:8000/api/v1/kite/token', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          access_token: tokenToValidate\n        })\n      });\n      if (!response.ok) {\n        throw new Error('Failed to set access token');\n      }\n\n      // Store the token\n      localStorage.setItem('kite_access_token', tokenToValidate);\n\n      // Update Redux state\n      dispatch(setAccessToken(tokenToValidate));\n      dispatch(setAuthenticated(true));\n\n      // Initialize WebSocket connection after token is set\n      connect();\n      setSuccessMessage('Access token saved successfully');\n      if (tokenToValidate === token) {\n        setToken('');\n      }\n    } catch (err) {\n      console.error('Error setting access token:', err);\n      setError('Invalid access token');\n      localStorage.removeItem('kite_access_token');\n      dispatch(setAccessToken(null));\n      dispatch(setAuthenticated(false));\n    } finally {\n      setLoading(false);\n    }\n  };\n  const handleSubmit = useCallback(async e => {\n    e.preventDefault();\n    if (!token.trim()) {\n      setError('Please enter an access token');\n      return;\n    }\n    await validateAndSetToken(token);\n  }, [token]);\n  const handleTokenChange = useCallback(e => {\n    setToken(e.target.value);\n    setError(null);\n  }, []);\n  const handleClose = () => {\n    setSuccessMessage('');\n  };\n  const handleErrorClose = () => {\n    setError(null);\n  };\n  return /*#__PURE__*/_jsxDEV(Box, {\n    component: \"form\",\n    onSubmit: handleSubmit,\n    sx: {\n      display: 'flex',\n      flexDirection: 'column',\n      gap: 2,\n      width: '100%'\n    },\n    children: [/*#__PURE__*/_jsxDEV(TextField, {\n      fullWidth: true,\n      label: \"Access Token\",\n      variant: \"outlined\",\n      value: token,\n      onChange: handleTokenChange,\n      disabled: loading,\n      placeholder: \"Enter your Kite access token\",\n      error: !!error,\n      helperText: error\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 110,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Button, {\n      type: \"submit\",\n      variant: \"contained\",\n      color: \"primary\",\n      disabled: loading || !token.trim(),\n      sx: {\n        alignSelf: 'flex-start'\n      },\n      children: loading ? /*#__PURE__*/_jsxDEV(CircularProgress, {\n        size: 24\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 128,\n        columnNumber: 20\n      }, this) : 'Save Token'\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Snackbar, {\n      open: !!successMessage,\n      autoHideDuration: 6000,\n      onClose: handleClose,\n      anchorOrigin: {\n        vertical: 'bottom',\n        horizontal: 'center'\n      },\n      children: /*#__PURE__*/_jsxDEV(Alert, {\n        onClose: handleClose,\n        severity: \"success\",\n        children: successMessage\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 137,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 131,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 100,\n    columnNumber: 5\n  }, this);\n};\n_s(AccessTokenInput, \"MBKLlJuzSrRvzVFsPaIoiZjuL0g=\", false, function () {\n  return [useDispatch, useSelector, useWebSocket];\n});\n_c = AccessTokenInput;\nvar _c;\n$RefreshReg$(_c, \"AccessTokenInput\");","map":{"version":3,"names":["React","useState","useCallback","useEffect","useDispatch","useSelector","Box","TextField","Button","CircularProgress","Snackbar","Alert","setAccessToken","setAuthenticated","useWebSocket","jsxDEV","_jsxDEV","AccessTokenInput","_s","dispatch","isAuthenticated","state","auth","token","setToken","loading","setLoading","successMessage","setSuccessMessage","error","setError","connect","savedToken","localStorage","getItem","validateAndSetToken","tokenToValidate","validateResponse","fetch","headers","ok","Error","response","method","body","JSON","stringify","access_token","setItem","err","console","removeItem","handleSubmit","e","preventDefault","trim","handleTokenChange","target","value","handleClose","handleErrorClose","component","onSubmit","sx","display","flexDirection","gap","width","children","fullWidth","label","variant","onChange","disabled","placeholder","helperText","fileName","_jsxFileName","lineNumber","columnNumber","type","color","alignSelf","size","open","autoHideDuration","onClose","anchorOrigin","vertical","horizontal","severity","_c","$RefreshReg$"],"sources":["C:/Users/inder/CascadeProjects/KavasCAPITALFASTAPI-new/frontend/src/components/Auth/AccessTokenInput.tsx"],"sourcesContent":["import React, { useState, useCallback, useEffect } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { Box, TextField, Button, CircularProgress, Snackbar, Alert } from '@mui/material';\nimport type { RootState } from '../../store';\nimport { setAccessToken, setAuthenticated } from '../../store/slices/authSlice';\nimport { useWebSocket } from '../../hooks/useWebSocket';\n\nexport const AccessTokenInput: React.FC = () => {\n  const dispatch = useDispatch();\n  const { isAuthenticated } = useSelector((state: RootState) => state.auth);\n  const [token, setToken] = useState('');\n  const [loading, setLoading] = useState(false);\n  const [successMessage, setSuccessMessage] = useState('');\n  const [error, setError] = useState<string | null>(null);\n  const { connect } = useWebSocket();\n\n  // Check for existing token on mount\n  useEffect(() => {\n    const savedToken = localStorage.getItem('kite_access_token');\n    if (savedToken) {\n      validateAndSetToken(savedToken);\n    }\n  }, []);\n\n  const validateAndSetToken = async (tokenToValidate: string) => {\n    setLoading(true);\n    try {\n      // First validate the token\n      const validateResponse = await fetch('http://localhost:8000/api/v1/kite/validate', {\n        headers: {\n          'Authorization': `Bearer ${tokenToValidate}`\n        }\n      });\n\n      if (!validateResponse.ok) {\n        throw new Error('Invalid token');\n      }\n\n      // If validation successful, set the token\n      const response = await fetch('http://localhost:8000/api/v1/kite/token', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ access_token: tokenToValidate }),\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to set access token');\n      }\n\n      // Store the token\n      localStorage.setItem('kite_access_token', tokenToValidate);\n      \n      // Update Redux state\n      dispatch(setAccessToken(tokenToValidate));\n      dispatch(setAuthenticated(true));\n      \n      // Initialize WebSocket connection after token is set\n      connect();\n      setSuccessMessage('Access token saved successfully');\n      if (tokenToValidate === token) {\n        setToken('');\n      }\n    } catch (err) {\n      console.error('Error setting access token:', err);\n      setError('Invalid access token');\n      localStorage.removeItem('kite_access_token');\n      dispatch(setAccessToken(null));\n      dispatch(setAuthenticated(false));\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleSubmit = useCallback(async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!token.trim()) {\n      setError('Please enter an access token');\n      return;\n    }\n\n    await validateAndSetToken(token);\n  }, [token]);\n\n  const handleTokenChange = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {\n    setToken(e.target.value);\n    setError(null);\n  }, []);\n\n  const handleClose = () => {\n    setSuccessMessage('');\n  };\n\n  const handleErrorClose = () => {\n    setError(null);\n  };\n\n  return (\n    <Box\n      component=\"form\"\n      onSubmit={handleSubmit}\n      sx={{\n        display: 'flex',\n        flexDirection: 'column',\n        gap: 2,\n        width: '100%',\n      }}\n    >\n      <TextField\n        fullWidth\n        label=\"Access Token\"\n        variant=\"outlined\"\n        value={token}\n        onChange={handleTokenChange}\n        disabled={loading}\n        placeholder=\"Enter your Kite access token\"\n        error={!!error}\n        helperText={error}\n      />\n      <Button\n        type=\"submit\"\n        variant=\"contained\"\n        color=\"primary\"\n        disabled={loading || !token.trim()}\n        sx={{ alignSelf: 'flex-start' }}\n      >\n        {loading ? <CircularProgress size={24} /> : 'Save Token'}\n      </Button>\n\n      <Snackbar\n        open={!!successMessage}\n        autoHideDuration={6000}\n        onClose={handleClose}\n        anchorOrigin={{ vertical: 'bottom', horizontal: 'center' }}\n      >\n        <Alert onClose={handleClose} severity=\"success\">\n          {successMessage}\n        </Alert>\n      </Snackbar>\n    </Box>\n  );\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}