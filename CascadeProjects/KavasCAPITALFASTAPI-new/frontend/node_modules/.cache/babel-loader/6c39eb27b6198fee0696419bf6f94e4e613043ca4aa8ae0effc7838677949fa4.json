{"ast":null,"code":"import axios from 'axios';\nconst BASE_URL = process.env.REACT_APP_API_URL || 'http://localhost:8000/api/v1';\n\n// Interface for API error response\n\n// Custom error class for API errors\nexport class ApiError extends Error {\n  constructor(status, message, details) {\n    super(message);\n    this.status = status;\n    this.message = message;\n    this.details = details;\n    this.name = 'ApiError';\n  }\n}\n\n// Create axios instance with default config\nconst apiClient = axios.create({\n  baseURL: BASE_URL,\n  headers: {\n    'Content-Type': 'application/json'\n  }\n});\n\n// Add request interceptor to include auth token\napiClient.interceptors.request.use(config => {\n  const token = localStorage.getItem('kite_access_token');\n  if (token) {\n    config.headers.Authorization = `Bearer ${token}`;\n  }\n  return config;\n});\n\n// Add response interceptor for error handling\napiClient.interceptors.response.use(response => response, error => {\n  console.error('API Error:', error);\n  if (error.response) {\n    var _error$response$data;\n    // Server responded with error\n    const status = error.response.status;\n    const detail = ((_error$response$data = error.response.data) === null || _error$response$data === void 0 ? void 0 : _error$response$data.detail) || error.message;\n    let message = 'An error occurred';\n    if (status === 401) {\n      message = 'Authentication failed. Please check your access token.';\n      // Clear invalid token\n      localStorage.removeItem('kite_access_token');\n    } else if (status === 403) {\n      message = 'Access denied. Please check your permissions.';\n    } else if (status === 404) {\n      message = 'Resource not found.';\n    } else if (status >= 500) {\n      message = 'Server error. Please try again later.';\n    }\n    throw new ApiError(status, message, detail);\n  } else if (error.request) {\n    // Request made but no response\n    throw new ApiError(0, 'No response from server. Please check your connection.', error.message);\n  } else {\n    // Request setup error\n    throw new ApiError(0, 'Failed to make request', error.message);\n  }\n});\nexport const marketDataApi = {\n  async getMarketData(instrumentToken, startTime, endTime, limit = 1000) {\n    try {\n      const response = await apiClient.get(`/market-data/tick/${instrumentToken}`, {\n        params: {\n          start_time: startTime,\n          end_time: endTime,\n          limit\n        }\n      });\n      return response.data;\n    } catch (error) {\n      console.error('Error fetching market data:', error);\n      throw error;\n    }\n  },\n  async getMarketDepth(instrumentToken) {\n    try {\n      const response = await apiClient.get(`/market-data/depth/${instrumentToken}`);\n      return response.data;\n    } catch (error) {\n      console.error('Error fetching market depth:', error);\n      throw error;\n    }\n  },\n  async validateToken(token) {\n    try {\n      console.log('Validating token:', token.substring(0, 5) + '...');\n      const response = await apiClient.get('/kite/validate', {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      });\n      console.log('Token validation successful:', response.data);\n      return response.data;\n    } catch (error) {\n      console.error('Token validation error:', error);\n      throw error;\n    }\n  }\n};","map":{"version":3,"names":["axios","BASE_URL","process","env","REACT_APP_API_URL","ApiError","Error","constructor","status","message","details","name","apiClient","create","baseURL","headers","interceptors","request","use","config","token","localStorage","getItem","Authorization","response","error","console","_error$response$data","detail","data","removeItem","marketDataApi","getMarketData","instrumentToken","startTime","endTime","limit","get","params","start_time","end_time","getMarketDepth","validateToken","log","substring"],"sources":["C:/Users/inder/CascadeProjects/KavasCAPITALFASTAPI-new/frontend/src/services/api/marketDataApi.ts"],"sourcesContent":["import axios, { AxiosError } from 'axios';\nimport { MarketData, MarketDepth } from '../../types/marketData';\n\nconst BASE_URL = process.env.REACT_APP_API_URL || 'http://localhost:8000/api/v1';\n\n// Interface for API error response\ninterface ApiErrorResponse {\n    detail?: string;\n    message?: string;\n    status?: number;\n}\n\n// Custom error class for API errors\nexport class ApiError extends Error {\n    constructor(\n        public status: number,\n        public message: string,\n        public details?: any\n    ) {\n        super(message);\n        this.name = 'ApiError';\n    }\n}\n\n// Create axios instance with default config\nconst apiClient = axios.create({\n    baseURL: BASE_URL,\n    headers: {\n        'Content-Type': 'application/json'\n    }\n});\n\n// Add request interceptor to include auth token\napiClient.interceptors.request.use((config) => {\n    const token = localStorage.getItem('kite_access_token');\n    if (token) {\n        config.headers.Authorization = `Bearer ${token}`;\n    }\n    return config;\n});\n\n// Add response interceptor for error handling\napiClient.interceptors.response.use(\n    (response) => response,\n    (error: AxiosError<ApiErrorResponse>) => {\n        console.error('API Error:', error);\n        \n        if (error.response) {\n            // Server responded with error\n            const status = error.response.status;\n            const detail = error.response.data?.detail || error.message;\n            \n            let message = 'An error occurred';\n            if (status === 401) {\n                message = 'Authentication failed. Please check your access token.';\n                // Clear invalid token\n                localStorage.removeItem('kite_access_token');\n            } else if (status === 403) {\n                message = 'Access denied. Please check your permissions.';\n            } else if (status === 404) {\n                message = 'Resource not found.';\n            } else if (status >= 500) {\n                message = 'Server error. Please try again later.';\n            }\n\n            throw new ApiError(status, message, detail);\n        } else if (error.request) {\n            // Request made but no response\n            throw new ApiError(0, 'No response from server. Please check your connection.', error.message);\n        } else {\n            // Request setup error\n            throw new ApiError(0, 'Failed to make request', error.message);\n        }\n    }\n);\n\nexport const marketDataApi = {\n    async getMarketData(\n        instrumentToken: number,\n        startTime: string,\n        endTime: string,\n        limit: number = 1000\n    ): Promise<MarketData[]> {\n        try {\n            const response = await apiClient.get(`/market-data/tick/${instrumentToken}`, {\n                params: {\n                    start_time: startTime,\n                    end_time: endTime,\n                    limit\n                }\n            });\n            return response.data;\n        } catch (error) {\n            console.error('Error fetching market data:', error);\n            throw error;\n        }\n    },\n\n    async getMarketDepth(instrumentToken: number): Promise<MarketDepth> {\n        try {\n            const response = await apiClient.get(`/market-data/depth/${instrumentToken}`);\n            return response.data;\n        } catch (error) {\n            console.error('Error fetching market depth:', error);\n            throw error;\n        }\n    },\n\n    async validateToken(token: string): Promise<any> {\n        try {\n            console.log('Validating token:', token.substring(0, 5) + '...');\n            const response = await apiClient.get('/kite/validate', {\n                headers: {\n                    Authorization: `Bearer ${token}`\n                }\n            });\n            console.log('Token validation successful:', response.data);\n            return response.data;\n        } catch (error) {\n            console.error('Token validation error:', error);\n            throw error;\n        }\n    }\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}