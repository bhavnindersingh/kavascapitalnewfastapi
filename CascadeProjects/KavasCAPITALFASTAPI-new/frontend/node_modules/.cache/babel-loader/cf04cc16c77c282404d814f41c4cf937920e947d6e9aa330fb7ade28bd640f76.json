{"ast":null,"code":"import axios from 'axios';\nconst BASE_URL = process.env.REACT_APP_API_URL || 'http://localhost:8000/api/v1';\n\n// Interface for API error response\n\n// Custom error class for API errors\nexport class ApiError extends Error {\n  constructor(status, message, details) {\n    super(message);\n    this.status = status;\n    this.message = message;\n    this.details = details;\n    this.name = 'ApiError';\n  }\n}\n\n// Create axios instance with default config\nconst apiClient = axios.create({\n  baseURL: BASE_URL,\n  headers: {\n    'Content-Type': 'application/json',\n    'Accept': 'application/json'\n  },\n  // Add CORS settings\n  withCredentials: true\n});\n\n// Add request interceptor to include auth token and handle CORS\napiClient.interceptors.request.use(config => {\n  const token = localStorage.getItem('kite_access_token');\n  if (token) {\n    config.headers.Authorization = `Bearer ${token}`;\n  }\n\n  // Log the request for debugging\n  console.log('API Request:', {\n    url: config.url,\n    method: config.method,\n    headers: config.headers,\n    data: config.data\n  });\n  return config;\n}, error => {\n  console.error('Request interceptor error:', error);\n  return Promise.reject(error);\n});\n\n// Add response interceptor for error handling\napiClient.interceptors.response.use(response => {\n  // Log successful response\n  console.log('API Response:', {\n    status: response.status,\n    data: response.data,\n    headers: response.headers\n  });\n  return response;\n}, error => {\n  var _error$response, _error$response2, _error$response3;\n  console.error('API Error:', {\n    status: (_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.status,\n    data: (_error$response2 = error.response) === null || _error$response2 === void 0 ? void 0 : _error$response2.data,\n    headers: (_error$response3 = error.response) === null || _error$response3 === void 0 ? void 0 : _error$response3.headers,\n    message: error.message\n  });\n  if (error.response) {\n    var _error$response$data;\n    // Server responded with error\n    const status = error.response.status;\n    const detail = ((_error$response$data = error.response.data) === null || _error$response$data === void 0 ? void 0 : _error$response$data.detail) || error.message;\n    let message = 'An error occurred';\n    if (status === 401) {\n      message = 'Authentication failed. Please check your access token and try again.';\n      localStorage.removeItem('kite_access_token');\n    } else if (status === 403) {\n      message = 'Access denied. Please check your permissions.';\n    } else if (status === 404) {\n      message = 'Resource not found.';\n    } else if (status >= 500) {\n      message = 'Server error. Please try again later.';\n    }\n    throw new ApiError(status, message, detail);\n  } else if (error.request) {\n    // Request made but no response\n    throw new ApiError(0, 'No response from server. Please check if the backend is running.', error.message);\n  } else {\n    // Request setup error\n    throw new ApiError(0, 'Failed to make request', error.message);\n  }\n});\nexport const marketDataApi = {\n  async getMarketData(instrumentToken, startTime, endTime, limit = 1000) {\n    try {\n      const response = await apiClient.get(`/market-data/tick/${instrumentToken}`, {\n        params: {\n          start_time: startTime,\n          end_time: endTime,\n          limit\n        }\n      });\n      return response.data;\n    } catch (error) {\n      console.error('Error fetching market data:', error);\n      throw error;\n    }\n  },\n  async getMarketDepth(instrumentToken) {\n    try {\n      const response = await apiClient.get(`/market-data/depth/${instrumentToken}`);\n      return response.data;\n    } catch (error) {\n      console.error('Error fetching market depth:', error);\n      throw error;\n    }\n  },\n  async validateToken(token) {\n    try {\n      console.log('Attempting to validate token:', token.substring(0, 5) + '...');\n      const response = await apiClient.get('/kite/validate', {\n        headers: {\n          Authorization: `Bearer ${token}`,\n          'Cache-Control': 'no-cache'\n        }\n      });\n      console.log('Token validation successful:', response.data);\n      return response.data;\n    } catch (error) {\n      console.error('Token validation error:', error);\n      throw error;\n    }\n  }\n};","map":{"version":3,"names":["axios","BASE_URL","process","env","REACT_APP_API_URL","ApiError","Error","constructor","status","message","details","name","apiClient","create","baseURL","headers","withCredentials","interceptors","request","use","config","token","localStorage","getItem","Authorization","console","log","url","method","data","error","Promise","reject","response","_error$response","_error$response2","_error$response3","_error$response$data","detail","removeItem","marketDataApi","getMarketData","instrumentToken","startTime","endTime","limit","get","params","start_time","end_time","getMarketDepth","validateToken","substring"],"sources":["C:/Users/inder/CascadeProjects/KavasCAPITALFASTAPI-new/frontend/src/services/api/marketDataApi.ts"],"sourcesContent":["import axios, { AxiosError } from 'axios';\nimport { MarketData, MarketDepth } from '../../types/marketData';\n\nconst BASE_URL = process.env.REACT_APP_API_URL || 'http://localhost:8000/api/v1';\n\n// Interface for API error response\ninterface ApiErrorResponse {\n    detail?: string;\n    message?: string;\n    status?: number;\n}\n\n// Custom error class for API errors\nexport class ApiError extends Error {\n    constructor(\n        public status: number,\n        public message: string,\n        public details?: any\n    ) {\n        super(message);\n        this.name = 'ApiError';\n    }\n}\n\n// Create axios instance with default config\nconst apiClient = axios.create({\n    baseURL: BASE_URL,\n    headers: {\n        'Content-Type': 'application/json',\n        'Accept': 'application/json'\n    },\n    // Add CORS settings\n    withCredentials: true\n});\n\n// Add request interceptor to include auth token and handle CORS\napiClient.interceptors.request.use((config) => {\n    const token = localStorage.getItem('kite_access_token');\n    if (token) {\n        config.headers.Authorization = `Bearer ${token}`;\n    }\n    \n    // Log the request for debugging\n    console.log('API Request:', {\n        url: config.url,\n        method: config.method,\n        headers: config.headers,\n        data: config.data\n    });\n    \n    return config;\n}, (error) => {\n    console.error('Request interceptor error:', error);\n    return Promise.reject(error);\n});\n\n// Add response interceptor for error handling\napiClient.interceptors.response.use(\n    (response) => {\n        // Log successful response\n        console.log('API Response:', {\n            status: response.status,\n            data: response.data,\n            headers: response.headers\n        });\n        return response;\n    },\n    (error: AxiosError<ApiErrorResponse>) => {\n        console.error('API Error:', {\n            status: error.response?.status,\n            data: error.response?.data,\n            headers: error.response?.headers,\n            message: error.message\n        });\n        \n        if (error.response) {\n            // Server responded with error\n            const status = error.response.status;\n            const detail = error.response.data?.detail || error.message;\n            \n            let message = 'An error occurred';\n            if (status === 401) {\n                message = 'Authentication failed. Please check your access token and try again.';\n                localStorage.removeItem('kite_access_token');\n            } else if (status === 403) {\n                message = 'Access denied. Please check your permissions.';\n            } else if (status === 404) {\n                message = 'Resource not found.';\n            } else if (status >= 500) {\n                message = 'Server error. Please try again later.';\n            }\n\n            throw new ApiError(status, message, detail);\n        } else if (error.request) {\n            // Request made but no response\n            throw new ApiError(0, 'No response from server. Please check if the backend is running.', error.message);\n        } else {\n            // Request setup error\n            throw new ApiError(0, 'Failed to make request', error.message);\n        }\n    }\n);\n\nexport const marketDataApi = {\n    async getMarketData(\n        instrumentToken: number,\n        startTime: string,\n        endTime: string,\n        limit: number = 1000\n    ): Promise<MarketData[]> {\n        try {\n            const response = await apiClient.get(`/market-data/tick/${instrumentToken}`, {\n                params: {\n                    start_time: startTime,\n                    end_time: endTime,\n                    limit\n                }\n            });\n            return response.data;\n        } catch (error) {\n            console.error('Error fetching market data:', error);\n            throw error;\n        }\n    },\n\n    async getMarketDepth(instrumentToken: number): Promise<MarketDepth> {\n        try {\n            const response = await apiClient.get(`/market-data/depth/${instrumentToken}`);\n            return response.data;\n        } catch (error) {\n            console.error('Error fetching market depth:', error);\n            throw error;\n        }\n    },\n\n    async validateToken(token: string): Promise<any> {\n        try {\n            console.log('Attempting to validate token:', token.substring(0, 5) + '...');\n            const response = await apiClient.get('/kite/validate', {\n                headers: {\n                    Authorization: `Bearer ${token}`,\n                    'Cache-Control': 'no-cache'\n                }\n            });\n            console.log('Token validation successful:', response.data);\n            return response.data;\n        } catch (error) {\n            console.error('Token validation error:', error);\n            throw error;\n        }\n    }\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}