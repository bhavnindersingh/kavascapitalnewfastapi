{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\inder\\\\CascadeProjects\\\\KavasCAPITALFASTAPI-new\\\\frontend\\\\src\\\\components\\\\Auth\\\\AccessTokenInput.tsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useCallback } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { Box, TextField, Button, CircularProgress, Snackbar, Alert } from '@mui/material';\nimport { setAccessToken, setError as setAuthError } from '../../store/slices/authSlice';\nimport { useWebSocket } from '../../hooks/useWebSocket';\nimport axios from 'axios';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst BASE_URL = process.env.REACT_APP_API_URL || 'http://localhost:8000/api/v1';\nexport const AccessTokenInput = () => {\n  _s();\n  const dispatch = useDispatch();\n  const {\n    isAuthenticated,\n    loading: authLoading,\n    error: authError\n  } = useSelector(state => state.auth);\n  const [token, setToken] = useState('');\n  const [loading, setLoading] = useState(false);\n  const [successMessage, setSuccessMessage] = useState('');\n  const {\n    connect\n  } = useWebSocket();\n  const validateAndSetToken = async tokenToValidate => {\n    setLoading(true);\n    try {\n      // First validate the token\n      const validateResponse = await axios.get(`${BASE_URL}/kite/validate`, {\n        headers: {\n          'Authorization': `Bearer ${tokenToValidate}`,\n          'Content-Type': 'application/json'\n        }\n      });\n      if (validateResponse.status !== 200) {\n        throw new Error('Token validation failed');\n      }\n\n      // If validation successful, set the token\n      const response = await axios.post(`${BASE_URL}/kite/token`, {\n        access_token: tokenToValidate\n      }, {\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${tokenToValidate}`\n        }\n      });\n      if (!response.data || response.status !== 200) {\n        throw new Error('Failed to set access token');\n      }\n\n      // Store token in localStorage\n      localStorage.setItem('kite_access_token', tokenToValidate);\n\n      // Update Redux state\n      dispatch(setAccessToken(tokenToValidate));\n\n      // Initialize WebSocket connection after token is set\n      connect();\n      setSuccessMessage('Access token saved successfully');\n      if (tokenToValidate === token) {\n        setToken('');\n      }\n    } catch (error) {\n      var _error$response, _error$response$data;\n      console.error('Error setting access token:', error);\n      const errorMessage = ((_error$response = error.response) === null || _error$response === void 0 ? void 0 : (_error$response$data = _error$response.data) === null || _error$response$data === void 0 ? void 0 : _error$response$data.detail) || error.message || 'Invalid access token';\n      dispatch(setAuthError(errorMessage));\n      dispatch(setAccessToken(null));\n      localStorage.removeItem('kite_access_token');\n    } finally {\n      setLoading(false);\n    }\n  };\n  const handleSubmit = useCallback(async e => {\n    e.preventDefault();\n    if (!token.trim()) {\n      dispatch(setAuthError('Please enter an access token'));\n      return;\n    }\n    await validateAndSetToken(token);\n  }, [token, dispatch]);\n  const handleTokenChange = useCallback(e => {\n    setToken(e.target.value);\n    if (authError) {\n      dispatch(setAuthError(null));\n    }\n  }, [authError, dispatch]);\n  const handleClose = () => {\n    setSuccessMessage('');\n  };\n  return /*#__PURE__*/_jsxDEV(Box, {\n    component: \"form\",\n    onSubmit: handleSubmit,\n    sx: {\n      display: 'flex',\n      flexDirection: 'column',\n      gap: 2,\n      maxWidth: 400,\n      margin: '0 auto',\n      padding: 2\n    },\n    children: [/*#__PURE__*/_jsxDEV(TextField, {\n      fullWidth: true,\n      label: \"Access Token\",\n      value: token,\n      onChange: handleTokenChange,\n      error: Boolean(authError),\n      helperText: authError || '',\n      disabled: loading || authLoading\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Button, {\n      type: \"submit\",\n      variant: \"contained\",\n      disabled: loading || authLoading,\n      sx: {\n        position: 'relative'\n      },\n      children: loading || authLoading ? /*#__PURE__*/_jsxDEV(CircularProgress, {\n        size: 24,\n        sx: {\n          position: 'absolute'\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 122,\n        columnNumber: 11\n      }, this) : isAuthenticated ? 'Update Token' : 'Set Token'\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 115,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Snackbar, {\n      open: Boolean(successMessage),\n      autoHideDuration: 6000,\n      onClose: handleClose,\n      anchorOrigin: {\n        vertical: 'bottom',\n        horizontal: 'center'\n      },\n      children: /*#__PURE__*/_jsxDEV(Alert, {\n        onClose: handleClose,\n        severity: \"success\",\n        sx: {\n          width: '100%'\n        },\n        children: successMessage\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 132,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 126,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 94,\n    columnNumber: 5\n  }, this);\n};\n_s(AccessTokenInput, \"JiiLNuhR5rp+VpGZYbK5pFEm5Fw=\", false, function () {\n  return [useDispatch, useSelector, useWebSocket];\n});\n_c = AccessTokenInput;\nvar _c;\n$RefreshReg$(_c, \"AccessTokenInput\");","map":{"version":3,"names":["React","useState","useCallback","useDispatch","useSelector","Box","TextField","Button","CircularProgress","Snackbar","Alert","setAccessToken","setError","setAuthError","useWebSocket","axios","jsxDEV","_jsxDEV","BASE_URL","process","env","REACT_APP_API_URL","AccessTokenInput","_s","dispatch","isAuthenticated","loading","authLoading","error","authError","state","auth","token","setToken","setLoading","successMessage","setSuccessMessage","connect","validateAndSetToken","tokenToValidate","validateResponse","get","headers","status","Error","response","post","access_token","data","localStorage","setItem","_error$response","_error$response$data","console","errorMessage","detail","message","removeItem","handleSubmit","e","preventDefault","trim","handleTokenChange","target","value","handleClose","component","onSubmit","sx","display","flexDirection","gap","maxWidth","margin","padding","children","fullWidth","label","onChange","Boolean","helperText","disabled","fileName","_jsxFileName","lineNumber","columnNumber","type","variant","position","size","open","autoHideDuration","onClose","anchorOrigin","vertical","horizontal","severity","width","_c","$RefreshReg$"],"sources":["C:/Users/inder/CascadeProjects/KavasCAPITALFASTAPI-new/frontend/src/components/Auth/AccessTokenInput.tsx"],"sourcesContent":["import React, { useState, useCallback } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { Box, TextField, Button, CircularProgress, Snackbar, Alert } from '@mui/material';\nimport type { RootState } from '../../store';\nimport { setAccessToken, setError as setAuthError } from '../../store/slices/authSlice';\nimport { useWebSocket } from '../../hooks/useWebSocket';\nimport axios from 'axios';\n\nconst BASE_URL = process.env.REACT_APP_API_URL || 'http://localhost:8000/api/v1';\n\nexport const AccessTokenInput: React.FC = () => {\n  const dispatch = useDispatch();\n  const { isAuthenticated, loading: authLoading, error: authError } = useSelector((state: RootState) => state.auth);\n  const [token, setToken] = useState('');\n  const [loading, setLoading] = useState(false);\n  const [successMessage, setSuccessMessage] = useState('');\n  const { connect } = useWebSocket();\n\n  const validateAndSetToken = async (tokenToValidate: string) => {\n    setLoading(true);\n    try {\n      // First validate the token\n      const validateResponse = await axios.get(`${BASE_URL}/kite/validate`, {\n        headers: {\n          'Authorization': `Bearer ${tokenToValidate}`,\n          'Content-Type': 'application/json'\n        }\n      });\n\n      if (validateResponse.status !== 200) {\n        throw new Error('Token validation failed');\n      }\n\n      // If validation successful, set the token\n      const response = await axios.post(`${BASE_URL}/kite/token`, \n        { access_token: tokenToValidate },\n        {\n          headers: {\n            'Content-Type': 'application/json',\n            'Authorization': `Bearer ${tokenToValidate}`\n          }\n        }\n      );\n\n      if (!response.data || response.status !== 200) {\n        throw new Error('Failed to set access token');\n      }\n\n      // Store token in localStorage\n      localStorage.setItem('kite_access_token', tokenToValidate);\n\n      // Update Redux state\n      dispatch(setAccessToken(tokenToValidate));\n      \n      // Initialize WebSocket connection after token is set\n      connect();\n      setSuccessMessage('Access token saved successfully');\n      if (tokenToValidate === token) {\n        setToken('');\n      }\n    } catch (error: any) {\n      console.error('Error setting access token:', error);\n      const errorMessage = error.response?.data?.detail || error.message || 'Invalid access token';\n      dispatch(setAuthError(errorMessage));\n      dispatch(setAccessToken(null));\n      localStorage.removeItem('kite_access_token');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleSubmit = useCallback(async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!token.trim()) {\n      dispatch(setAuthError('Please enter an access token'));\n      return;\n    }\n\n    await validateAndSetToken(token);\n  }, [token, dispatch]);\n\n  const handleTokenChange = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {\n    setToken(e.target.value);\n    if (authError) {\n      dispatch(setAuthError(null));\n    }\n  }, [authError, dispatch]);\n\n  const handleClose = () => {\n    setSuccessMessage('');\n  };\n\n  return (\n    <Box\n      component=\"form\"\n      onSubmit={handleSubmit}\n      sx={{\n        display: 'flex',\n        flexDirection: 'column',\n        gap: 2,\n        maxWidth: 400,\n        margin: '0 auto',\n        padding: 2,\n      }}\n    >\n      <TextField\n        fullWidth\n        label=\"Access Token\"\n        value={token}\n        onChange={handleTokenChange}\n        error={Boolean(authError)}\n        helperText={authError || ''}\n        disabled={loading || authLoading}\n      />\n      <Button\n        type=\"submit\"\n        variant=\"contained\"\n        disabled={loading || authLoading}\n        sx={{ position: 'relative' }}\n      >\n        {loading || authLoading ? (\n          <CircularProgress size={24} sx={{ position: 'absolute' }} />\n        ) : isAuthenticated ? 'Update Token' : 'Set Token'}\n      </Button>\n\n      <Snackbar\n        open={Boolean(successMessage)}\n        autoHideDuration={6000}\n        onClose={handleClose}\n        anchorOrigin={{ vertical: 'bottom', horizontal: 'center' }}\n      >\n        <Alert onClose={handleClose} severity=\"success\" sx={{ width: '100%' }}>\n          {successMessage}\n        </Alert>\n      </Snackbar>\n    </Box>\n  );\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}